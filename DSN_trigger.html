<!DOCTYPE html>
<html>
<head>
  <title>Trigger DSN Analysis</title>
</head>
<body>
<h2>ğŸ“Š Running DSN Analysis...</h2>
<div id="status">â³ Starting...</div>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const label = urlParams.get("label");
  const from = urlParams.get("from");
  const to = urlParams.get("to");

  const payload = { label, from, to };
  const webhook = "https://007588b16436.ngrok-free.app/DSN_webhook";

  fetch(webhook, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(r => r.ok ? "âœ… Triggered!" : "âŒ Failed (" + r.status + ")")
  .catch(() => "âŒ Network error")
  .then(msg => {
    document.getElementById("status").textContent = msg;
    const resultLink = `${label}.analysis.html`;
    document.getElementById("status").innerHTML += `<br><a href="${resultLink}">ğŸ”— View Dashboard</a>`;
  });
</script>
</body>
</html>
